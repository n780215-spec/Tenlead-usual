<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no">
<title>å¤©éº—è³¼è²·æ¸…å–®</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4CAF50"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="å¤©éº—æ¸…å–®">
<link rel="apple-touch-icon" href="icon-192.png">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
body { font-family: "Microsoft JhengHei", sans-serif; padding: 8px; background: #f9f9f9; font-size: 13px; }
h2,h3 { color: #333; font-size: 16px; margin: 8px 0; }
.table-container { margin-bottom: 8px; }
table { width: 100%; border-collapse: collapse; font-size: 13px; table-layout: fixed; }
th, td { border: 1px solid #ccc; padding: 4px; text-align: center; word-wrap: break-word; }
th { background: #eee; font-size: 13px; }
th:nth-child(1) { width: 40%; }
th:nth-child(2), th:nth-child(3) { width: 20%; }
th:nth-child(4) { width: 20%; }

.quantity-control { display: flex; justify-content: center; align-items: center; gap: 4px; }
.quantity-control button { padding: 2px 6px; font-size: 14px; }
.quantity-control span { min-width: 24px; text-align: center; display: inline-block; }

.btn { padding: 10px; background: #0078D7; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; width: 100%; margin: 8px 0; }
.btn:hover { background: #005a9e; }

.highlight { color: red; font-weight: bold; }
.result { margin-top: 8px; padding: 10px; background: #fff; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); font-size: 13px; line-height: 1.4; }
ul { padding-left: 18px; margin: 4px 0; }
.level-buttons, .membership-buttons { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 8px; }
.level-buttons button, .membership-buttons button { flex: 1; min-width: 70px; padding: 6px; border: 1px solid #ccc; border-radius: 6px; background: #f1f1f1; cursor: pointer; font-size: 12px; }
.level-buttons button.active, .membership-buttons button.active { background: #0078D7; color: white; border-color: #0078D7; }

/* æµ®å‹•å€å¡Š */
#floatingSummary {
  position: fixed;
  bottom: 12px;
  right: 12px;
  background: rgba(76,175,80,0.95);
  color: white;
  padding: 10px 14px;
  border-radius: 10px;
  font-size: 13px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  z-index: 999;
}
</style>
</head>
<body>

<h2>å¤©éº—2025å‘¨å¹´æ…¶è¨‚å–®è¨ˆç®—</h2>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th>ç”¢å“</th>
        <th>åƒ¹æ ¼</th>
        <th>PV</th>
        <th>æ•¸é‡</th>
      </tr>
    </thead>
    <tbody id="productTable"></tbody>
  </table>
</div>

<h2>æœƒå“¡è³‡æ ¼</h2>
<div class="membership-buttons" id="membershipButtons"></div>

<h2>æœƒå“¡ç­‰ç´š</h2>
<div class="level-buttons" id="memberButtons"></div>

<div class="result" id="resultBox">
  ğŸ‘‰ è«‹è¼¸å…¥æ•¸é‡ï¼Œé¸æ“‡æœƒå“¡è³‡æ ¼åŠæœƒå“¡ç­‰ç´š
</div>

<!-- åŠŸèƒ½æŒ‰éˆ• -->
<button class="btn" onclick="resetForm()">ğŸ”„ é‡æ–°æ•´ç†</button>
<button class="btn" onclick="downloadAsImage()">ğŸ“¥ ä¸‹è¼‰æ¸…å–®åœ–ç‰‡</button>

<!-- æµ®å‹•ç¸½è¨ˆ -->
<div id="floatingSummary">ç¸½åƒ¹: 0 å…ƒ<br>ç¸½PV: 0</div>

<script>
const products = [
  { code:"A1",name:"A1æ·±å±¤æ½”è†šæ²¹",price:1995,pv:1700 },
  { code:"1",name:"1è™Ÿ é›™æ•ˆæ½”é¡éœ²",price:1995,pv:1700 },
  { code:"2",name:"2è™Ÿ å¹³è¡¡æŸ”è†šéœ²",price:1995,pv:1700 },
  { code:"3",name:"3è™Ÿ å…¨æ•ˆç·Šç·»çœ¼éœœ",price:3990,pv:3500 },
  { code:"4",name:"4è™Ÿ ç…¥ç™½æ™¶è¯éœœ",price:4200,pv:3600 },
  { code:"5",name:"5è™Ÿ å‡è¡¡èª¿ç†éœœ",price:4200,pv:3600 },
  { code:"6A",name:"6A äº®ç™½é˜²è­·éœœ",price:3990,pv:3500 },
  { code:"6B",name:"6B æ½¤ç™½é˜²è­·éœœ",price:3990,pv:3500 },
  { code:"8",name:"8è™Ÿ è³¦æ´»æ™¶è¯éœœ",price:3990,pv:3500 },
  { code:"9",name:"9è™Ÿ ä¿æ¿•ä¿®è­·éœœ",price:2415,pv:1800 },
  { code:"10",name:"10è™Ÿ Cæ¶²",price:3465,pv:3000 },
  { code:"12",name:"12è™Ÿ ç…¥é‡‡é’æ˜¥éœ²",price:2415,pv:1800 },
  { code:"13",name:"Bioé›ªè‚Œé¢è†œ",price:2415,pv:1800 },
  { code:"C1",name:"Cç²‰/ç“¶",price:3465,pv:3000 },
  { code:"C10",name:"Cç²‰/10ç“¶/ç›’",price:29400,pv:26000 },
  { code:"H1",name:"é’æ˜¥å…ƒç´ -F",price:1995,pv:1700 },
  { code:"H2",name:"é’æ˜¥å…ƒç´ -L",price:1995,pv:1700 },
  { code:"H3",name:"çº–éº—365ç¬¬2ä»£",price:2625,pv:2300 },
  { code:"H4",name:"çº–éº—365 S1",price:2625,pv:2300 },
  { code:"H5",name:"æ©„æ¬–æ²¹",price:3210,pv:2400 },
  { code:"H6",name:"ç´…åƒç²¾è¯é£²",price:3210,pv:2400 },
  { code:"H7",name:"éº—ç©©åº·",price:3210,pv:2200 },
  { code:"H8",name:"éº—ç©©è†³",price:3210,pv:2200 }
];

const memberBonusRate={ "æœƒå“¡":0,"å°ˆå“¡":0.25,"ä¸»ä»»":0.3,"ç¶“ç†":0.35,"å¯¶çŸ³":0.37,"é‘½çŸ³":0.38,"é‡‘é‘½":0.39,"é¡§å•":0.4 };
let selectedLevel="æœƒå“¡";
let selectedMembership="æ–°æœƒå“¡";
const membershipFee={ "æ–°æœƒå“¡":1000,"çºŒç´„æœƒå“¡":500,"ä¸éœ€ç¹³ç´çºŒç´„è²»":0 };

// æœƒå“¡ç­‰ç´šæŒ‰éˆ•
const memberButtons=document.getElementById("memberButtons");
Object.keys(memberBonusRate).forEach(level=>{
  const btn=document.createElement("button");
  btn.textContent=level;
  btn.onclick=()=>{
    selectedLevel=level;
    document.querySelectorAll(".level-buttons button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    updateSummary();
  };
  if(level==="æœƒå“¡") btn.classList.add("active");
  memberButtons.appendChild(btn);
});

// æœƒå“¡è³‡æ ¼æŒ‰éˆ•
const membershipButtons=document.getElementById("membershipButtons");
Object.keys(membershipFee).forEach(type=>{
  const displayText=type==="ä¸éœ€ç¹³ç´çºŒç´„è²»"? "ä¸éœ€ç¹³ç´çºŒç´„è²» $0" : `${type} $${membershipFee[type]}`;
  const btn=document.createElement("button");
  btn.textContent=displayText;
  btn.onclick=()=>{
    selectedMembership=type;
    document.querySelectorAll(".membership-buttons button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    updateSummary();
  };
  if(type==="æ–°æœƒå“¡") btn.classList.add("active");
  membershipButtons.appendChild(btn);
});

// å•†å“è¡¨æ ¼
const tableBody=document.getElementById("productTable");
products.forEach((p,index)=>{
  const row=document.createElement("tr");
  row.innerHTML=`
    <td>${p.name}</td>
    <td>${p.price}</td>
    <td>${p.pv}</td>
    <td>
      <div class="quantity-control">
        <button onclick="changeQty(${index},-1)">-</button>
        <span id="qty${index}">0</span>
        <button onclick="changeQty(${index},1)">+</button>
      </div>
    </td>`;
  tableBody.appendChild(row);
});

// æ”¹è®Šæ•¸é‡
function changeQty(index,delta){
  const qtyEl=document.getElementById(`qty${index}`);
  let value=parseInt(qtyEl.textContent)||0;
  value=Math.max(0,value+delta);
  qtyEl.textContent=value;
  updateSummary();
}

// æ›´æ–°æ¸…å–® + æµ®å‹•å€å¡Š
function updateSummary(){
  let productTotal=0,totalPV=0,listHTML="";
  products.forEach((p,index)=>{
    const qty=parseInt(document.getElementById(`qty${index}`).textContent)||0;
    if(qty>0){
      listHTML+=`<li>${p.name} Ã— ${qty} = ${p.price*qty} å…ƒ / PV ${p.pv*qty}</li>`;
      productTotal+=p.price*qty;
      totalPV+=p.pv*qty;
    }
  });

  let membershipCost=membershipFee[selectedMembership];
  let membershipLabel=selectedMembership==="æ–°æœƒå“¡"? "å…¥æœƒè²»":selectedMembership==="çºŒç´„æœƒå“¡"? "çºŒç´„è²»":"å·²ç¹³ç´çºŒç´„è²»";
  let totalMoney=productTotal+(selectedMembership==="ä¸éœ€ç¹³ç´çºŒç´„è²»"?0:membershipCost);

  let effectivePV=totalPV;
  if(selectedMembership==="æ–°æœƒå“¡") effectivePV=Math.max(0,totalPV-28001);

  const performanceBonus=effectivePV*memberBonusRate[selectedLevel];

  let result=`<h3>ğŸ§¾ æ¸…å–®</h3>
  <ul>${listHTML||"<li>æœªé¸è³¼å•†å“</li>"}</ul>
  <p>ğŸ’° å•†å“ç¸½åƒ¹ï¼š<span class="highlight">${productTotal}</span> å…ƒ</p>
  <p>ğŸ“Š ç¸½ PVï¼š<span class="highlight">${totalPV}</span></p>
  <p>ğŸ’° ${membershipLabel}ï¼š<span class="highlight">${membershipCost>0?membershipCost:""}</span></p>
  <p>ğŸ’° ç¸½é‡‘é¡ï¼š<span class="highlight">${totalMoney}</span> å…ƒ</p>
  <p>ğŸ‘¤ æœƒå“¡ç­‰ç´šï¼š<span class="highlight">${selectedLevel}</span></p>
  ${selectedMembership==="æ–°æœƒå“¡"? `<p>âš ï¸ æ–°æœƒå“¡ PV æ‰£é™¤ 28001ï¼Œæ¥­ç¸¾çé‡‘è¨ˆç®— PVï¼š<span class="highlight">${effectivePV}</span></p>`:""}
  <p>ğŸ¯ æ¥­ç¸¾çé‡‘ï¼š<span class="highlight">${performanceBonus.toFixed(0)}</span> å…ƒ</p>`;

  document.getElementById("resultBox").innerHTML=result;

  // ğŸ‘‰ æ›´æ–°æµ®å‹•å€å¡Š
  document.getElementById("floatingSummary").innerHTML=
    `ç¸½åƒ¹: ${productTotal} å…ƒ<br>ç¸½PV: ${totalPV}`;
}

// é‡æ–°æ•´ç†
function resetForm(){
  products.forEach((p,index)=>document.getElementById(`qty${index}`).textContent=0);
  selectedLevel="æœƒå“¡";
  selectedMembership="æ–°æœƒå“¡";
  document.querySelectorAll(".level-buttons button, .membership-buttons button").forEach(b=>b.classList.remove("active"));
  document.querySelector(".level-buttons button").classList.add("active");
  document.querySelector(".membership-buttons button").classList.add("active");
  updateSummary();
}

// ä¸‹è¼‰æ¸…å–®åœ–ç‰‡
function downloadAsImage(){
  const element=document.getElementById("resultBox");
  html2canvas(element,{backgroundColor:"#ffffff",scale:2}).then(canvas=>{
    const imgData=canvas.toDataURL("image/png");
    const link=document.createElement("a");
    link.href=imgData;
    link.download="å¤©éº—è³¼è²·æ¸…å–®.png";
    link.click();
  });
}
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js")
      .then(() => console.log("Service Worker å·²è¨»å†Š"))
      .catch(err => console.error("Service Worker è¨»å†Šå¤±æ•—", err));
  }
</script>
</body>
</html>
